# Introductory_Networking

参考&ハンズオン: https://tryhackme.com/room/introtonetworking

## OSI参照モデル
|階層|OSI参照モデル|
|---|---|
|7|アプリケーション|
|6|プレゼンテーション|
|5|セッション|
|4|トランスポート|
|3|ネットワーク|
|2|データリンク|
|1|物理|

- 第7層: メール，ログインなど，特定のアプリケーションに特化したプロトコル(通信規格)。アプリケーション層にデータを与えると、プレゼンテーション層にデータが渡される
- 第6層: 機器固有のデータフォーマットと，ネットワーク共通のデータフォーマットの変換・交換(暗号化，圧縮...)を行う。その後セッション層に渡す
- 第5層: コネクション(データが流れる論理的通信路)の確立。失敗なら切断。
セッションは独立して確立される。
- 第4層: 両端ノード間のデータ転送の管理。
最初にプロトコルを選択する。TCPやUDPなどといったものがある。後述
    - TCP: 両端のホスト間でデータの到達性を保証する。確実性のために何度もやりとりを行うので，扱うデータ量が少ない場合は無駄が多い。そこで...
    - UDP: コネクションレス，一方的なトランスポートプロトコル。確実性はアプリケーションに任せる。TCPだと無駄が多い場合，ビデオなどのマルチメディア通信に効果的。
- 第3層: 宛先までデータを届ける。最適な経路設定や制御を確立し，複数のネットワークがルーターで繋がった先にある場合でも対応できる。
- 第2層: 0,1の数字の列を送信に適した形に整形して伝送する。データの破損もここで確認。
- 第1層: ビットの列(0,1の数字の列)と電圧の高低を変換する。

## カプセル化
- データ通信は第7層~第1層(送信側)→(受信側第1層~第7層という順で行われる。
- 送信側で上位層から順に"ヘッダ"と呼ばれる制御情報を付加していき(カプセル化)，受信側で下位層から順にヘッダを確認していき(非カプセル化)，最終的に到達する。
- カプセル化は第4層から行われ，カプセル化したデータは名称が変わる。
  - 4: セグメント
  - 3: パケット
  - 2: フレーム
  - 1: ビット

## TCP/IPモデル
最近はコチラの方が主流。


|OSI参照モデル|TCP/IP|
|---|---|
|アプリケーション|アプリケーション|
|プレゼンテーション||
|セッション||
|トランスポート|トランスポート|
|ネットワーク|インターネット|
|データリンク|ネットワークインターフェース|
|物理||

### 3-Way ハンドシェイク
TCPはコネクション型プロトコル（通信相手の応答があってはじめて通信を開始する）であることから、データ転送を行う前にコネクションの確立を行う。
このTCPにおいて使用されるコネクションの確立のことを3ウェイハンドシェイクという。
以下の手順の通り “3回のやりとり" によって確立される

1. 接続を確立しようとすると、まず、接続を初期化することを示す特別な要求がリモート サーバーに送信されます。この要求にはSYN (short for synchronise) ビットと呼ばれるものが含まれています。
2. サーバーは SYN ビットを含むパケットと、ACK(acknowledgement)ビットで応答します。最後に、コンピュータは ACK ビットを含むパケットを単独で送信し、接続が正常にセットアップされたことを確認します。
3. 3方向ハンドシェイクが正常に完了すると、データは 2 台のコンピュータ間で確実に転送されます。(送信時に失われたり破損したりするデータは再送信される)
![](ni-1.png)

## Ping コマンド
ping コマンドは、リモート リソースへの接続が可能かどうかをテストするときに使用します。

一番最初に接続先のIPアドレスを返してくれる。

> ping は ICMP プロトコルという，TCP/IP プロトコルの 1つを使用して動作する。
> ICMPは OSI モデルのネットワーク層、つまり TCP/IP モデルのインターネット層で動作する

**実行方法:**
```
ping <target>
```
> target にはipアドレス，URLどちらをいれてもOK

-i: 送信された ping 要求の間隔を，秒単位で変更できる
-4: IPv4に限定
-v: 詳細な出力

**ハンズオン:** 
- www.google.com にpingを飛ばしてみよう！
- googleのIPアドレスは?

## Traceroute コマンド
要求がターゲットに向かう際に使用するパスを一覧できる。

**実行方法:**
```
traceroute <destination>
```

- -i: インターフェースを指定
-  -T: TCP SYN を使用

## Whois コマンド
　ドメインの所有者やネームサーバ、登録日などのドメイン情報を表示する


**実行方法:**
```
whois <target>
```

**ハンズオン:** 
- FACEBOOK(facebook.com)の郵便番号は?


## Dig コマンド

URLとIPアドレスは，**DNS**と呼ばれるTCP/IPプロトコルを用いて変換される。

ping コマンドなどで，IPアドレス，URLどちらを入力してもOKといったが，URLを使った場合は下記のようにしてIPアドレスに変換が行われる:

たとえば、www.google.com 要求を行った場合、コンピュータはまずキャッシュDNS サーバーに要求を送信します。その後、サーバーはGoogleのIPアドレスを探しに行き、それを私たちに送り返します。その後、当社のコンピュータは、GoogleサーバーのIPに要求を送信することができます。
このようにしてwww.google.comを開くことができます。

> 詳しくは... https://www.nic.ad.jp/ja/newsletter/No51/0800.html
の"名前解決の流れ"をチェック

基本この操作は自動で行われるが，**Dig コマンド** を用いて手動でも行える。

```
dig <domain> @<dns-server-ip>
Ex. dig google.com @1.1.1.1
```

DNSサーバーのIPとしては
- 1.1.1.1: CloudflareとAPINC共同のDNSサーバ。最速かつプライバシー優先なのでオススメ
- 8.8.8.8, 8.8.4.4: GoogleのDNSサーバ
