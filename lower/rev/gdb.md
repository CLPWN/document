# GDB(GDB-PEDA)の使い方

## GDBについて
GDB(GNUデバッガ)は実行ファイルの動作を詳細に解析できるデバッガである。

ブレークポイントを設置し，任意の場所で動作を停止させて変数やレジスタの中身を見たり，書き換えたり，１ステップごとに実行したりといった，動的な解析が可能になる。

radare2とも似通ったところが多いが，それぞれの違いを理解し，状況に応じて使い分けられるようにすると良い。

## GDBのセットアップ
```
git clone https://github.com/longld/peda.git ~/peda
echo "source ~/peda/peda.py" >> ~/.gdbinit
```

## 起動と実行
```
# 起動。gdb ./<実行ファイル>
$ gdb ./intro
```

```
# 関数の実行。引数も渡せる
gdb-peda$ run AAAAA
```

```
# pythonを呼び出してその結果を引数に渡したり...といったことも
gdb-peda$ run $(python3 -c "print('A'*5)")
```

## アセンブリコードの表示
```
# disas <関数> で逆アセンブル。
gdb-peda$ disas main
```

## ブレークポイントの設置と利用
```
# break *<アドレス(*0x........)>
# break <関数>
gdb-peda$ break main
gdb-peda$ break *0x08048a04
```

runコマンドで動かすと，設置したブレークポイントで停止。

停止すると，

- レジスタの値
- 現在の実行位置とその周辺の命令
- スタックの状態

がわかる。

### 注意
**=>** のマークの箇所で処理がストップしている。

**=>** が指している命令はまだ実行されていない!!

### 1行ごとに命令を進める
```
# 一時停止した状態で処理を一つ次に進めて一時停止。
gdb-peda$ next
```

### ブレークポイント->ブレークポイントの実行
```
# 現在一時停止中の場所から次のブレークポイントまで処理を継続。
gdb-peda$ continue
```

### ブレークポイントの確認と削除
```
# ブレークポイントの確認
info breakpoints

# ブレークポイントの削除。一覧の Num でBPを指定
delete breakpoints 1
```

## レジスタ，メモリの中身を表示，書き換える
任意のアドレスに入っている内容を参照するには，**xコマンド(eXamine)** をつかう。

例として，rbpレジスタに入っているアドレスから，32bit単位で32個16進数表示する。

> レジスタの先頭に$ をつけることで，レジスタの内容を示す。

> $<レジスタ名> と書くことで，レジスタの内容をアドレスとして指定できる！

```
gdb-peda$ x/32xw $rbp
```
- 各種パラメータの説明:
  - 32: 32個のアドレスを表示
  - x: 符号なし16進数値
  - w: Word=4バイト=32ビット表記。
    - 最近のマシンは64bitなので，g: Giant=8バイト=64ビット表記の方が親和性高いかも...?
- その他のパラメータについては:
  - https://flex.phys.tohoku.ac.jp/texi/gdb-j/gdb-j_41.html

### レジスタ，メモリの内容を書き換える
```
# set$<レジスタ>=<値>
# set{データ型}<メモリアドレス>=<値>

gdb-peda$ set $rax=0x1
gdb-peda$ set {int}0xffffcd98=42
```